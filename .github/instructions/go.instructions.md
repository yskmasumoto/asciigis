---
applyTo: "**/*.go"
excludeAgent: ["coding-agent"]
---

# go.instructions.md

このリポジトリで Go コードを生成・編集するときの指針です。

## 1. プロジェクト構成（必須）

- Go のディレクトリ構成・責務分離は、`https://github.com/golang-standards/project-layout` に従う。
- このリポジトリでは特に次を優先する：
	- `cmd/`：実行可能（エントリポイント）。例：`cmd/asciigis/main.go`
	- `internal/`：リポジトリ内専用の実装（外部公開しない）。例：`internal/geo/`, `internal/tui/`
	- `pkg/`：外部からも利用されうる安定API（必要な場合のみ）。例：`pkg/asciigis/`
- 追加コードの置き場所に迷ったら、原則 `internal/` を優先し、公開が必要になってから `pkg/` へ昇格する。

## 2. コーディング規約

- フォーマット：`gofmt` 前提。import 整理は `goimports` 互換の並びを意識する（標準 / 外部 / ローカル）。
- 命名：Go 標準の慣例（短く明確、頭字語は `ID`, `URL` のように大文字）。
- 返り値：エラーは最後。成功/失敗が明確な API にする。
- nil の扱い：nil を返しうる場合はドキュメント/呼び出し側の取り扱いが明確になるように設計する。
- interface：必要になってから最小限で定義（受け口側で定義するのが基本）。

## 3. エラー処理

- エラーは握りつぶさず返す。
- 文脈付け：必要に応じて `fmt.Errorf("...: %w", err)` でラップする。
- sentinel error / `errors.Is` / `errors.As` の使い分けを意識する（判定が必要なら sentinel or 型）。

## 4. コンテキストとI/O

- 長時間処理や外部I/O（ファイル読み取り、ネットワーク等）が絡む場合は `context.Context` を受け取れる設計を優先する。
- 外部入力（JSON/CSV/ユーザー入力）はパース失敗や不正値を前提にバリデーションする。

## 5. テスト

- 可能な範囲で `*_test.go` を追加する（特に `internal/geo` など純粋関数的なロジック）。
- テストは決定的（deterministic）にする。時刻・乱数・環境依存は注入（dependency injection）で制御する。

## 6. 依存関係

- 新規依存の追加は慎重に行う（必要性・保守性・サイズを考慮）。
- 既存の標準ライブラリで足りる場合は標準を優先する。
- 既存の標準ライブラリで足りる場合は標準を優先する。

